<html>
    <head>
        <link href="bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="dc.css"/>
        <script type="text/javascript" src="d3.js"></script>
        <script type="text/javascript" src="crossfilter.js"></script>
        <script type="text/javascript" src="dc.js"></script>
        <script type="text/javascript" src="reductio.min.js"></script>       
    </head>
    <body>MedData Dashboard</body>
    <div class="container">
        <div class="row">
            <div id="select1">
                <div>
                    <a class='reset' href="javascript:console.log(select1);select1.filterAll();dc.redrawAll('reductio')"  style='visibility: hidden;'>reset</a>
                </div>
            </div>
        </div>
        <div class="row">    
            <div id="ring-chart-exposure" class="col-sm-6"></div>
            <div id="row-chart-profession" class="col-sm-6"></div>
        </div>
    </div>   
<script language="javascript">
var exposureGroup;
var exposureDim;
var professionDim;
var select1 = dc.selectMenu('#select1',"reductio");
d3.csv("MDG_Combined_Audience-Exposure_Dataset.csv", function(error,data) {    
    console.log(error);  
    if (error) throw error;
    
    ndx=crossfilter(data);
    exposureDim     =   ndx.dimension(function(d){return d["Exposed"]});
    professionDim   =   ndx.dimension(function(d){return d["MDG PROFESSION"]});

    exposureGroup=exposureDim.group();
    professionGroup=professionDim.group();

    var reducer =   reductio()
                    .exception(function(d) { return d.MDG_PSID; })
                    .exceptionCount(true);
                    //.exceptionSum(function(d) { return d.num; });

    reducer(exposureGroup);
    reducer(professionGroup);

    console.log(professionGroup.top(Infinity));
    

    var ExposureRing        = dc.pieChart("#ring-chart-exposure","reductio");
    var ProfessionBarChart  = dc.rowChart("#row-chart-profession","reductio");
    
    select1
    .dimension(professionDim)
    .group(professionDim.group())
    .controlsUseVisibility(true);

    ExposureRing
    .width(250).height(250)
    .dimension(exposureDim)
    .group(exposureGroup)
    .legend(dc.legend())
    .valueAccessor(function (p) {
            return p.value.exceptionCount;
        })
    .innerRadius(60);
    
    /*ExposureRing.on('pretransition', function(chart) {
          chart.selectAll('.pie-slice text')
              .text('')
            .append('tspan')
              .text(function(d) { return d.name; })
            .append('tspan')
              .attr('x', 100)
              .attr('text-anchor', 'end')
              .text(function(d) { return d.data; });
      });
*/
    console.log(ProfessionBarChart);    
     
     ProfessionBarChart
    .dimension(professionDim)
    .group(professionGroup)
    .elasticX(true)
    .valueAccessor(function (p) {
            return p.value.exceptionCount;
        })
        .labelOffsetX(10)
    .on('renderlet', function(chart) {
        chart.selectAll('rect').on("click", function(d) {
            console.log("click!", d);
        });
    });
    
    dc.renderAll("reductio");
});




    </script>
    </html>